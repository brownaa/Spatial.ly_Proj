unzip("data/01/London_Sport1.zip", overwrite = TRUE, exdir = "data")
require(downloader)
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf"
download(url, dest = "data/02/james_cheshire_ggplot_intro_blog.pdf", mode = "wb")
if(!file.exists('./data/02/Intro_R_Data.zip')){
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip"
download(url, dest = "data/02/Intro_R_Data.zip", mode = "wb")
}
unzip("data/02/Intro_R_Data.zip", overwrite = TRUE, exdir = "data/02")
if(!file.exists('./data/02/intro_to_R1.pdf')){
url <- "http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf"
download(url, dest = "data/02/intro_to_R1.pdf", mode = "wb")
}
if(!file.exists('./data/02/R-ggplot2-data.zip')){
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip"
download(url, dest = "data/02/R-ggplot2-data.zip", mode = "wb")
}
unzip("data/02/R-ggplot2-data.zip", overwrite = TRUE, exdir = "data/02")
if(!file.exists('./data/02/james_cheshire_ggplot_intro_blog.pdf')){
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf"
download(url, dest = "data/02/james_cheshire_ggplot_intro_blog.pdf", mode = "wb")
}
install.packages(c("ggplot2", "RgoogleMaps", "png", "sp", "spdep"))
if(!file.exists('./data/02/Intro_R_Data.zip')){
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip"
download(url, dest = "data/02/Intro_R_Data.zip", mode = "wb")
}
unzip("data/02/Intro_R_Data.zip", overwrite = TRUE, exdir = "data/02")
if(!file.exists('./data/02/intro_to_R1.pdf')){
url <- "http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf"
download(url, dest = "data/02/intro_to_R1.pdf", mode = "wb")
}
if(!file.exists('./data/02/R-ggplot2-data.zip')){
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip"
download(url, dest = "data/02/R-ggplot2-data.zip", mode = "wb")
}
unzip("data/02/R-ggplot2-data.zip", overwrite = TRUE, exdir = "data/02")
if(!file.exists('./data/02/james_cheshire_ggplot_intro_blog.pdf')){
url <- "http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf"
download(url, dest = "data/02/james_cheshire_ggplot_intro_blog.pdf", mode = "wb")
}
data.dir <- 'data/02/'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, 'Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, 'Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
?unzip
data.dir <- './data/02/'
unzip(paste0(data.dir, 'Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
unzip(paste0(data.dir, 'Intro_R_Data.zip'), overwrite = TRUE, exdir = "data/02")
data.dir <- 'data/02'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, '/Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
data.dir <- 'data/02'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, '/Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/intro_to_R1.pdf'))){
url <- 'http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf'
download(url, dest = paste0(data.dir, '/intro_to_R1.pdf'), mode = 'wb')
}
if(!file.exists(paste0(data.dir, '/R-ggplot2-data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip'
download(url, dest = paste0(data.dir, '/R-ggplot2-data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/R-ggplot2-data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf'
download(url, dest = paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'), mode = 'wb')
}
schools.dat <- read.csv(paste0(data.dir, 'schools.csv'))
schools.dat <- read.csv(paste0(data.dir, '/schools.csv'))
library(knitr)
opts_knit$set(root.dir = '..')
library(ProjectTemplate)
load.project()
data.dir <- 'data/02'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, '/Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/intro_to_R1.pdf'))){
url <- 'http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf'
download(url, dest = paste0(data.dir, '/intro_to_R1.pdf'), mode = 'wb')
}
if(!file.exists(paste0(data.dir, '/R-ggplot2-data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip'
download(url, dest = paste0(data.dir, '/R-ggplot2-data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/R-ggplot2-data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf'
download(url, dest = paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'), mode = 'wb')
}
schools.dat <- read.csv(paste0(data.dir, '/schools.csv'))
head(schools.dat); tail(schools.dat)
library(knitr)
opts_knit$set(root.dir = '..')
library(ProjectTemplate)
load.project()
data.dir <- 'data/02'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, '/Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/intro_to_R1.pdf'))){
url <- 'http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf'
download(url, dest = paste0(data.dir, '/intro_to_R1.pdf'), mode = 'wb')
}
if(!file.exists(paste0(data.dir, '/R-ggplot2-data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip'
download(url, dest = paste0(data.dir, '/R-ggplot2-data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/R-ggplot2-data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf'
download(url, dest = paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'), mode = 'wb')
}
schools.dat <- read.csv(paste0(data.dir, '/schools.csv'))
head(schools.dat); tail(schools.dat)
summary(schools.dat)
names(schools.dat)
ncol(schools.dat)
nrow(schools.dat)
complete.cases(schools.dat)
attach(schools.dat)
stripchart(attainment, method="stack", xlab="Mean Prior Attainment by School")
hist(attainment, col="light blue", border="dark blue",
freq=F, ylim=c(0,0.30),xlab=”Mean attainment)
hist(attainment, col="light blue", border="dark blue", freq=F, ylim=c(0,0.30),xlab=”Mean attainment)
hist(attainment, col="light blue", border="dark blue", freq=F, ylim=c(0,0.30),xlab="Mean attainment")
attach(schools.dat)
stripchart(attainment, method="stack", xlab="Mean Prior Attainment by School")
hist(attainment, col="light blue", border="dark blue", freq=F, ylim=c(0,0.30),xlab="Mean attainment")
rug(attainment)
lines(density(sort(attainment)))
xx <- seq(from=23, to=35, by=0.1)
yy <- dnorm(xx, mean(attainment), sd(attainment))
lines(xx, yy, lty="dotted")
rm(xx, yy)
legend("topright", legend=c("density curve","Normal curve"),
lty=c("solid","dotted"))
school.type <- rep("Not Faith/Selective", times=nrow(schools.dat))
school.type[coe==1] <- "VA CoE"
school.type[rc==1] <- "VA RC"
school.type[vol.con==1] <- "VC"
school.type[other.faith==1] <- "Other Faith"
school.type[selective==1] <- "Selective"
school.type <- factor(school.type)
levels(school.type)
par(mai=c(1,1.4,0.5,0.5))     # Changes the graphic margins
boxplot(attainment ~ school.type, horizontal=T, xlab="Mean attainment", las=1,
cex.axis=0.8)    # Includes options to draw the boxes and labels horizontally
abline(v=mean(attainment), lty="dashed")   # Adds the mean value to the plot
legend("topright", legend="Grand Mean", lty="dashed")
library(knitr)
opts_knit$set(root.dir = '..')
library(ProjectTemplate)
load.project()
data.dir <- 'data/02'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, '/Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/intro_to_R1.pdf'))){
url <- 'http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf'
download(url, dest = paste0(data.dir, '/intro_to_R1.pdf'), mode = 'wb')
}
if(!file.exists(paste0(data.dir, '/R-ggplot2-data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip'
download(url, dest = paste0(data.dir, '/R-ggplot2-data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/R-ggplot2-data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf'
download(url, dest = paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'), mode = 'wb')
}
schools.dat <- read.csv(paste0(data.dir, '/schools.csv'))
head(schools.dat); tail(schools.dat)
summary(schools.dat)
names(schools.dat)
ncol(schools.dat)
nrow(schools.dat)
complete.cases(schools.dat)
attach(schools.dat)
stripchart(attainment, method="stack", xlab="Mean Prior Attainment by School")
hist(attainment, col="light blue", border="dark blue", freq=F, ylim=c(0,0.30),xlab="Mean attainment")
rug(attainment)
lines(density(sort(attainment)))
xx <- seq(from=23, to=35, by=0.1)
yy <- dnorm(xx, mean(attainment), sd(attainment))
lines(xx, yy, lty="dotted")
rm(xx, yy)
legend("topright", legend=c("density curve","Normal curve"),
lty=c("solid","dotted"))
school.type <- rep("Not Faith/Selective", times=nrow(schools.dat))
school.type[coe==1] <- "VA CoE"
school.type[rc==1] <- "VA RC"
school.type[vol.con==1] <- "VC"
school.type[other.faith==1] <- "Other Faith"
school.type[selective==1] <- "Selective"
school.type <- factor(school.type)
levels(school.type)
par(mai=c(1,1.4,0.5,0.5))     # Changes the graphic margins
boxplot(attainment ~ school.type, horizontal=T, xlab="Mean attainment", las=1,
cex.axis=0.8)    # Includes options to draw the boxes and labels horizontally
abline(v=mean(attainment), lty="dashed")   # Adds the mean value to the plot
legend("topright", legend="Grand Mean", lty="dashed")
summary(aov(attainment ~ school.type))
# Finds the attainment scores for schools with the highest proportions of FSM pupils
attainment.high.fsm.schools <- attainment[fsm > quantile(fsm, probs=0.75)]
# Finds the attainment scores for schools with the lowest proportions of FSM pupils
attainment.low.fsm.schools <- attainment[fsm < quantile(fsm, probs=0.25)]
t.test(attainment.high.fsm.schools, attainment.low.fsm.schools)
round(cor(fsm, attainment),3)
cor.test(fsm, attainment)
plot(attainment ~ fsm)
# Adds a line of best fit (a regression line)
abline(lm(attainment ~ fsm))
model1 <- lm(attainment ~ fsm, data=schools.dat)
summary(model1)
model2 <- lm(attainment ~ fsm + white, data=schools.dat)
summary(model2)
model3 <- update(model2, . ~ . + selective)
summary(model3)
lm(formula = attainment ~ fsm + white + selective, data = schools.dat)
model4 <- update(model3, . ~ . - white)
anova(model4, model3)
plot(Easting, Northing, asp=1, main="Map of London schools")
plot(Easting, Northing, asp=1, main="Map of London schools", cex=sqrt(esl*5))
plot(Easting, Northing, asp=1, main="Map of London schools", cex=sqrt(esl*5), pch=21, bg="yellow")
palette <- c("yellow","orange","red","purple")
map.class <-  cut(fsm, quantile(fsm), labels=FALSE, include.lowest=TRUE)
plot(Easting, Northing, asp=1, main="Map of London schools",
cex=sqrt(esl*5), pch=21, bg=palette[map.class])
MyMap <- MapBackground(lat=Lat, lon=Long)
PlotOnStaticMap(MyMap, Lat, Long, cex=sqrt(esl*5), pch=21, bg=palette[map.class])
legend("topleft", legend=paste("<",tapply(fsm, map.class, max)),
pch=21, pt.bg=palette, pt.cex=1.5, bg="white", title="P(FSM-eligible)")
legVals <- seq(from=0.2,to=1,by=0.2)
legend("topright", legend=round(legVals,3), pch=21, pt.bg="white",
pt.cex=sqrt(legVals*5), bg="white", title="P(ESL)")
detach(schools.dat)
schools.xy <- schools.dat
attach(schools.xy)
coordinates(schools.xy) <- c("Easting", "Northing")
# Converts into a spatial object
class(schools.xy)
detach(schools.xy)
proj4string(schools.xy) <- CRS("+proj=tmerc datum=OSGB36")
proj4string(schools.xy) <- CRS("+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
+y_0=-100000 +ellps=airy
+towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894
+units=m +no_defs")
nearest.six <- knearneigh(schools.xy, k=6, RANN=F)
nearest.six$nn[1,]
class(nearest.six)
neighbours <- knn2nb(nearest.six)
class(neighbours)
summary(neighbours)
plot(neighbours, coordinates(schools.xy))
spatial.weights <- nb2listw(neighbours)
lm.morantest(model4, spatial.weights)
data.dir <- 'data/02'
if(!file.exists(paste0(data.dir, 'Intro_R_Data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/Intro_R_Data.zip'
download(url, dest = paste0(data.dir, '/Intro_R_Data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/Intro_R_Data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/intro_to_R1.pdf'))){
url <- 'http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf'
download(url, dest = paste0(data.dir, '/intro_to_R1.pdf'), mode = 'wb')
}
data.dir <- 'data/03'
if(!file.exists(paste0(data.dir, '/R-ggplot2-data.zip'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/R-ggplot2-data.zip'
download(url, dest = paste0(data.dir, '/R-ggplot2-data.zip'), mode = 'wb')
}
unzip(paste0(data.dir, '/R-ggplot2-data.zip'), overwrite = TRUE, exdir = data.dir)
if(!file.exists(paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'))){
url <- 'http://spatialanalysis.co.uk/wp-content/uploads/2013/04/james_cheshire_ggplot_intro_blog.pdf'
download(url, dest = paste0(data.dir, '/james_cheshire_ggplot_intro_blog.pdf'), mode = 'wb')
}
sports <- readShapePoly(paste0(data.dir, '/london_sport.shp'))
str(sports)
install.packages("gcplib")
install.packages("gpclib")
sessionInfo()
install.packages("gpclib")
install.packages("devtools")
install_github("rdpeng/gpclib")
load.project()
library(ProjectTemplate)
load.project()
load.project()
install_github("rdpeng/gpclib")
input<-read.csv(paste0(data.dir, "/ambulance_assault.csv"))
paste0(data.dir, "/ambulance_assault.csv")
data.dir <- 'data/03'
input <- read.csv(paste0(data.dir, "/ambulance_assault.csv"))
london.data <- read.csv(paste0(data.dir, "/census-historic-population-borough.csv"))
london.data.melt <- melt(london.data, id=c("Area.Code", "Area.Name"))
require(reshape2)
london.data.melt <- melt(london.data, id=c("Area.Code", "Area.Name"))
